# Advanced React

## Notes

## Portals
- Portals provide a first-class way to render children into a DOM node that exists outside the DOM hierarchy of the parent component.
- This is useful for UI components like modals, tooltips, or hovercards that need to visually "break out" of their container (e.g. to avoid `overflow: hidden` or `z-index` issues).
- We use `createPortal` from `react-dom`.

### useRef
- `useRef` is a hook that returns a mutable ref object whose `.current` property is initialized to the passed argument.
- The returned object persists for the full lifetime of the component.
- It is commonly used to access a child imperatively (like a DOM node) or to keep a mutable variable that doesn't trigger a re-render when changed.

### Modal Implementation
- In `src/Modal.jsx`, we combine `useRef` and `createPortal` to create a reusable Modal component.
- **Singleton-like Container**: We use `useRef` to create a `div` element *once* and store it. This ensures the container `div` remains the same instance across re-renders of the Modal component.
```jsx
  const elRef = useRef(null);
  if (!elRef.current) {
    elRef.current = document.createElement("div");
  }
```
- **Mounting/Unmounting**: We use `useEffect` to append this `div` to the DOM (specifically to the `#modal` root) when the Modal mounts, and remove it when it unmounts.
```jsx
  useEffect(() => {
    const modalRoot = document.getElementById("modal");
    modalRoot.appendChild(elRef.current);
    return () => modalRoot.removeChild(elRef.current);
  }, []);
```
- **Rendering**: Finally, we use `createPortal` to render the `children` into that specific `div`.
```jsx
  return createPortal(<div>{children}</div>, elRef.current);
```

### Usage in Past Orders
- In `src/routes/past.lazy.jsx`, we use the `Modal` to display order details.
- Because the `Modal` uses `useRef` for its container, when the content inside the modal changes (e.g., from a "Loading..." state to displaying the table of items), the modal container itself does not get destroyed and recreated.
- This prevents flickering and loss of focus, providing a smoother user experience during state transitions inside the modal.

## Class Components